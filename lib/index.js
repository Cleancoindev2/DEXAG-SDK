"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_ethers=require("ethers"),_validation=_interopRequireDefault(require("./services/validation")),_api=_interopRequireDefault(require("./services/api")),_web=_interopRequireDefault(require("./services/web3")),_utility=_interopRequireDefault(require("./services/utility"));// Services
function fromPrivateKey(a){var b=new _ethers.ethers.providers.InfuraProvider("homestead","135bcba44428495c86d17c754d38649d"),c=new _ethers.ethers.Wallet(a,b);return new SDK(b,c)}function fromProvider(a){var b=new _ethers.ethers.providers.Web3Provider(a),c=b.getSigner();return new SDK(b,c)}var SDK=/*#__PURE__*/function(){function a(b,c){(0,_classCallCheck2["default"])(this,a),this.provider=b,this.signer=c,this.statusHandler=function(){}}return(0,_createClass2["default"])(a,[{key:"getTrade",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f,g,h,i;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.to,d=b.from,e=b.fromAmount,f=b.toAmount,g=b.limitAmount,h=b.dex,a.next=3,_api["default"].getTrade({to:c,from:d,fromAmount:e,toAmount:f,limitAmount:g,dex:h});case 3:return i=a.sent,a.abrupt("return",i);case 5:case"end":return a.stop();}},a)}));return function getTrade(){return a.apply(this,arguments)}}()},{key:"getPrice",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.to,d=b.from,e=b.fromAmount,f=b.toAmount,g=b.dex,a.next=3,_api["default"].getPrice({to:c,from:d,fromAmount:e,toAmount:f,dex:g});case 3:return h=a.sent,a.abrupt("return",h);case 5:case"end":return a.stop();}},a)}));return function getPrice(){return a.apply(this,arguments)}}()},{key:"trade",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c=b.metadata,d=c.input,e=c.output,f=c.source,g=c.query,h={pair:{base:g.to,quote:g.from},amount:g.fromAmount||g.toAmount,dex:f.dex,isBuying:!0},this._sendTrade(b,h);case 3:case"end":return a.stop();}},a,this)}));return function trade(){return a.apply(this,arguments)}}()},{key:"sendTrade",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this._sendTrade(b,c);case 1:case"end":return a.stop();}},a,this)}));return function sendTrade(){return a.apply(this,arguments)}}()},{key:"validate",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",_validation["default"].validate(b,this.provider,this.signer,this.statusHandler));case 1:case"end":return a.stop();}},a,this)}));return function validate(){return a.apply(this,arguments)}}()},{key:"registerStatusHandler",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this.statusHandler=b;case 1:case"end":return a.stop();}},a,this)}));return function registerStatusHandler(){return a.apply(this,arguments)}}()},{key:"_sendTrade",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c){var d,e,f,g,h,i;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=_ethers.ethers.utils.bigNumberify(b.trade.value),e={to:b.trade.to,data:b.trade.data,value:d,gasLimit:5e5},"bancor"==c.dex){a.next=10;break}return this.statusHandler("init"),a.next=6,_api["default"].getGas();case 6:f=a.sent,e.gasPrice=f,a.next=12;break;case 10:this.statusHandler("bancor_notice"),e.gasPrice=_ethers.ethers.utils.bigNumberify(b.metadata.gasPrice);case 12:return a.next=14,_web["default"].estimateGas(e,this.provider,this.signer,this.statusHandler);case 14:if(g=a.sent,e.gasLimit=g,g){a.next=18;break}return a.abrupt("return");case 18:return a.next=20,_web["default"].sendTrade(e,this.signer,this.statusHandler);case 20:if(h=a.sent,h){a.next=23;break}return a.abrupt("return");case 23:return this.statusHandler("send_trade",h.hash),a.next=26,this.provider.waitForTransaction(h.hash);case 26:i=a.sent,_api["default"].track(h,c,b),_utility["default"].handleReceipt(h,i,this.statusHandler);case 29:case"end":return a.stop();}},a,this)}));return function _sendTrade(){return a.apply(this,arguments)}}()}]),a}(),DEXAG={fromPrivateKey:fromPrivateKey,fromProvider:fromProvider},_default=DEXAG;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJmcm9tUHJpdmF0ZUtleSIsInByaXZhdGVLZXkiLCJwcm92aWRlciIsImV0aGVycyIsInByb3ZpZGVycyIsIkluZnVyYVByb3ZpZGVyIiwic2lnbmVyIiwiV2FsbGV0IiwiU0RLIiwiZnJvbVByb3ZpZGVyIiwiY3VycmVudFByb3ZpZGVyIiwiV2ViM1Byb3ZpZGVyIiwiZ2V0U2lnbmVyIiwic3RhdHVzSGFuZGxlciIsInRvIiwiZnJvbSIsImZyb21BbW91bnQiLCJ0b0Ftb3VudCIsImxpbWl0QW1vdW50IiwiZGV4IiwiYXBpIiwiZ2V0VHJhZGUiLCJ0cmFkZSIsImdldFByaWNlIiwidHgiLCJtZXRhZGF0YSIsImlucHV0Iiwib3V0cHV0Iiwic291cmNlIiwicXVlcnkiLCJkZXRhaWxzIiwicGFpciIsImJhc2UiLCJxdW90ZSIsImFtb3VudCIsImlzQnV5aW5nIiwiX3NlbmRUcmFkZSIsInZhbGlkYXRpb24iLCJ2YWxpZGF0ZSIsImhhbmRsZXIiLCJ2YWx1ZSIsInV0aWxzIiwiYmlnTnVtYmVyaWZ5IiwiZGF0YSIsImdhc0xpbWl0IiwiZ2V0R2FzIiwiZ2FzUHJpY2UiLCJ3ZWIzIiwiZXN0aW1hdGVHYXMiLCJzZW5kVHJhZGUiLCJzdGF0dXMiLCJoYXNoIiwid2FpdEZvclRyYW5zYWN0aW9uIiwicmVjZWlwdCIsInRyYWNrIiwidXRpbGl0eSIsImhhbmRsZVJlY2VpcHQiLCJERVhBRyJdLCJtYXBwaW5ncyI6Inl4QkFFQTtBQU1BLFFBQVNBLENBQUFBLGNBQVQsQ0FBd0JDLENBQXhCLENBQW9DLElBRTVCQyxDQUFBQSxDQUFRLENBQUcsR0FBSUMsZ0JBQU9DLFNBQVAsQ0FBaUJDLGNBQXJCLENBQW9DLFdBQXBDLG9DQUZpQixDQUc1QkMsQ0FBTSxDQUFHLEdBQUlILGdCQUFPSSxNQUFYLENBQWtCTixDQUFsQixDQUE4QkMsQ0FBOUIsQ0FIbUIsQ0FJbEMsTUFBTyxJQUFJTSxDQUFBQSxHQUFKLENBQVFOLENB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QUN1Qk8sZ0JBQUl5QixNQUFKLEUsUUFBakJDLEMsUUFDTnRCLENBQUUsQ0FBQ3NCLFFBQUgsQ0FBY0EsQyx5QkFFZCxLQUFLakMsYUFBTCxDQUFtQixlQUFuQixDLENBQ0FXLENBQUUsQ0FBQ3NCLFFBQUgsQ0FBYzNDLGVBQU9zQyxLQUFQLENBQWFDLFlBQWIsQ0FBMEJwQixDQUFLLENBQUNHLFFBQU4sQ0FBZXFCLFFBQXpDLEMsMEJBRU9DLGdCQUFLQyxXQUFMLENBQWlCeEIsQ0FBakIsQ0FBcUIsS0FBS3RCLFFBQTFCLENBQW9DLEtBQUtJLE1BQXpDLENBQWlELEtBQUtPLGFBQXRELEMsWUFBakIrQixDLFFBQ05wQixDQUFFLENBQUNvQixRQUFILENBQWNBLEMsQ0FDVEEsQyxxRUFHZ0JHLGdCQUFLRSxTQUFMLENBQWV6QixDQUFmLENBQW1CLEtBQUtsQixNQUF4QixDQUFnQyxLQUFLTyxhQUFyQyxDLFlBQWZxQyxDLFFBQ0RBLEMsMERBR0wsTUFBS3JDLGFBQUwsQ0FBbUIsWUFBbkIsQ0FBaUNxQyxDQUFNLENBQUNDLElBQXhDLEMsV0FDc0IsS0FBS2pELFFBQUwsQ0FBY2tELGtCQUFkLENBQWlDRixDQUFNLENBQUNDLElBQXhDLEMsU0FBaEJFLEMsUUFDTmpDLGdCQUFJa0MsS0FBSixDQUFVSixDQUFWLENBQWtCcEIsQ0FBbEIsQ0FBMkJSLENBQTNCLEMsQ0FDQWlDLG9CQUFRQyxhQUFSLENBQXNCTixDQUF0QixDQUE4QkcsQ0FBOUIsQ0FBdUMsS0FBS3hDLGFBQTVDLEMseUhBSUU0QyxLQUFLLENBQUcsQ0FDWnpELGNBQWMsQ0FBZEEsY0FEWSxDQUVaUyxZQUFZLENBQVpBLFlBRlksQyxVQUtDZ0QsSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV0aGVycyB9IGZyb20gJ2V0aGVycyc7XG5cbi8vIFNlcnZpY2VzXG5pbXBvcnQgdmFsaWRhdGlvbiBmcm9tICcuL3NlcnZpY2VzL3ZhbGlkYXRpb24nO1xuaW1wb3J0IGFwaSBmcm9tICcuL3NlcnZpY2VzL2FwaSc7XG5pbXBvcnQgd2ViMyBmcm9tICcuL3NlcnZpY2VzL3dlYjMnO1xuaW1wb3J0IHV0aWxpdHkgZnJvbSAnLi9zZXJ2aWNlcy91dGlsaXR5JztcblxuZnVuY3Rpb24gZnJvbVByaXZhdGVLZXkocHJpdmF0ZUtleSkge1xuICBjb25zdCBwcm9qZWN0SWQgPSAnMTM1YmNiYTQ0NDI4NDk1Yzg2ZDE3Yzc1NGQzODY0OWQnO1xuICBjb25zdCBwcm92aWRlciA9IG5ldyBldGhlcnMucHJvdmlkZXJzLkluZnVyYVByb3ZpZGVyKCdob21lc3RlYWQnLCBwcm9qZWN0SWQpO1xuICBjb25zdCBzaWduZXIgPSBuZXcgZXRoZXJzLldhbGxldChwcml2YXRlS2V5LCBwcm92aWRlcik7XG4gIHJldHVybiBuZXcgU0RLKHByb3ZpZGVyLCBzaWduZXIpO1xufVxuXG5mdW5jdGlvbiBmcm9tUHJvdmlkZXIoY3VycmVudFByb3ZpZGVyKSB7XG4gIGNvbnN0IHByb3ZpZGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuV2ViM1Byb3ZpZGVyKGN1cnJlbnRQcm92aWRlcik7XG4gIGNvbnN0IHNpZ25lciA9IHByb3ZpZGVyLmdldFNpZ25lcigpO1xuICByZXR1cm4gbmV3IFNESyhwcm92aWRlciwgc2lnbmVyKTtcbn1cblxuY2xhc3MgU0RLIHtcbiAgY29uc3RydWN0b3IocHJvdmlkZXIsIHNpZ25lcikge1xuICAgIHRoaXMucHJvdmlkZXIgPSBwcm92aWRlcjtcbiAgICB0aGlzLnNpZ25lciA9IHNpZ25lcjtcbiAgICB0aGlzLnN0YXR1c0hhbmRsZXIgPSAoKSA9PiB7fSAvLyBwcmVzZXQgc3RhdHVzIGhhbmRsZXJcbiAgfVxuXG4gIGFzeW5jIGdldFRyYWRlKHt0bywgZnJvbSwgZnJvbUFtb3VudCwgdG9BbW91bnQsIGxpbWl0QW1vdW50LCBkZXh9KSB7XG4gICAgY29uc3QgdHJhZGUgPSBhd2FpdCBhcGkuZ2V0VHJhZGUoe3RvLCBmcm9tLCBmcm9tQW1vdW50LCB0b0Ftb3VudCwgbGltaXRBbW91bnQsIGRleH0pO1xuICAgIHJldHVybiB0cmFkZVxuICB9XG5cbiAgYXN5bmMgZ2V0UHJpY2Uoe3RvLCBmcm9tLCBmcm9tQW1vdW50LCB0b0Ftb3VudCwgZGV4fSkge1xuICAgIGNvbnN0IHRyYWRlID0gYXdhaXQgYXBpLmdldFByaWNlKHt0bywgZnJvbSwgZnJvbUFtb3VudCwgdG9BbW91bnQsIGRleH0pO1xuICAgIHJldHVybiB0cmFkZVxuICB9XG5cbiAgYXN5bmMgdHJhZGUodHgpIHtcbiAgICBsZXQge2lucHV0LCBvdXRwdXQsIHNvdXJjZSwgcXVlcnl9ID0gdHgubWV0YWRhdGE7XG4gICAgdmFyIGRldGFpbHMgPSB7cGFpcjoge2Jhc2U6cXVlcnkudG8sIHF1b3RlOnF1ZXJ5LmZyb219LCBhbW91bnQ6IHF1ZXJ5LmZyb21BbW91bnR8fHF1ZXJ5LnRvQW1vdW50LCBkZXg6IHNvdXJjZS5kZXgsIGlzQnV5aW5nOiB0cnVlfVxuICAgIHRoaXMuX3NlbmRUcmFkZSh0eCwgZGV0YWlscyk7XG4gIH1cblxuICBhc3luYyBzZW5kVHJhZGUodHgsIGRldGFpbHMpIHtcbiAgICB0aGlzLl9zZW5kVHJhZGUodHgsIGRldGFpbHMpO1xuICB9XG5cbiAgYXN5bmMgdmFsaWRhdGUodHgpIHtcbiAgICByZXR1cm4gdmFsaWRhdGlvbi52YWxpZGF0ZSh0eCwgdGhpcy5wcm92aWRlciwgdGhpcy5zaWduZXIsIHRoaXMuc3RhdHVzSGFuZGxlcik7XG4gIH1cblxuICBhc3luYyByZWdpc3RlclN0YXR1c0hhbmRsZXIoaGFuZGxlcikge1xuICAgIHRoaXMuc3RhdHVzSGFuZGxlciA9IGhhbmRsZXI7XG4gIH1cblxuICBhc3luYyBfc2VuZFRyYWRlKHRyYWRlLCBkZXRhaWxzKSB7XG4gICAgY29uc3QgdmFsdWUgPSBldGhlcnMudXRpbHMuYmlnTnVtYmVyaWZ5KHRyYWRlLnRyYWRlLnZhbHVlKTtcbiAgICBjb25zdCB0eCA9IHtcbiAgICAgIHRvOiB0cmFkZS50cmFkZS50byxcbiAgICAgIGRhdGE6IHRyYWRlLnRyYWRlLmRhdGEsXG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBnYXNMaW1pdDogNTAwMDAwXG4gICAgfTtcbiAgICAvLyBTZXQgZ2FzIGFuZCBoYW5kbGUgYmFuY29yIGV4Y2VwdGlvblxuICAgIGlmKGRldGFpbHMuZGV4IT0nYmFuY29yJyl7XG4gICAgICB0aGlzLnN0YXR1c0hhbmRsZXIoJ2luaXQnKTtcbiAgICAgIGNvbnN0IGdhc1ByaWNlID0gYXdhaXQgYXBpLmdldEdhcygpO1xuICAgICAgdHguZ2FzUHJpY2UgPSBnYXNQcmljZTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuc3RhdHVzSGFuZGxlcignYmFuY29yX25vdGljZScpO1xuICAgICAgdHguZ2FzUHJpY2UgPSBldGhlcnMudXRpbHMuYmlnTnVtYmVyaWZ5KHRyYWRlLm1ldGFkYXRhLmdhc1ByaWNlKTtcbiAgICB9XG4gICAgY29uc3QgZ2FzTGltaXQgPSBhd2FpdCB3ZWIzLmVzdGltYXRlR2FzKHR4LCB0aGlzLnByb3ZpZGVyLCB0aGlzLnNpZ25lciwgdGhpcy5zdGF0dXNIYW5kbGVyKTtcbiAgICB0eC5nYXNMaW1pdCA9IGdhc0xpbWl0O1xuICAgIGlmICghZ2FzTGltaXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc3RhdHVzID0gYXdhaXQgd2ViMy5zZW5kVHJhZGUodHgsIHRoaXMuc2lnbmVyLCB0aGlzLnN0YXR1c0hhbmRsZXIpO1xuICAgIGlmICghc3RhdHVzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc3RhdHVzSGFuZGxlcignc2VuZF90cmFkZScsIHN0YXR1cy5oYXNoKTtcbiAgICBjb25zdCByZWNlaXB0ID0gYXdhaXQgdGhpcy5wcm92aWRlci53YWl0Rm9yVHJhbnNhY3Rpb24oc3RhdHVzLmhhc2gpO1xuICAgIGFwaS50cmFjayhzdGF0dXMsIGRldGFpbHMsIHRyYWRlKTtcbiAgICB1dGlsaXR5LmhhbmRsZVJlY2VpcHQoc3RhdHVzLCByZWNlaXB0LCB0aGlzLnN0YXR1c0hhbmRsZXIpO1xuICB9XG59XG5cbmNvbnN0IERFWEFHID0ge1xuICBmcm9tUHJpdmF0ZUtleSxcbiAgZnJvbVByb3ZpZGVyLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgREVYQUc7XG4iXX0=