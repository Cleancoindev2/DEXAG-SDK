"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_ethers=require("ethers"),_utility=_interopRequireDefault(require("./utility")),_bignumber=require("bignumber.js"),trading={getGas:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a){try{fetch("https://ethgasstation.info/json/ethgasAPI.json").then(function(a){return a.json()}).then(function(b){a(_ethers.ethers.utils.bigNumberify(web3.toWei(b.fast/10,"gwei")))})}catch(b){// default to 5 if error
a(_ethers.ethers.utils.bigNumberify(web3.toWei(5,"gwei")))}}));case 1:case"end":return a.stop();}},a)}));return function getGas(){return a.apply(this,arguments)}}(),setAllowance:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d){var e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,trading.getGas();case 2:return e=a.sent,a.abrupt("return",new Promise(function(a){try{console.log(e);var f=b.functions.approve(c,"115792089237316195423570985008687907853269984665640564039457584007913129639935",{gasPrice:e});f.then(/*#__PURE__*/function(){var b=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function b(c){var e;return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return console.log(c),window.web3StatusHandler("send_trade",c.hash),b.next=4,_utility["default"].waitForReceipt(c.hash,d);case 4:e=b.sent,window.web3StatusHandler("mined_approve",c.hash),a(!0);case 7:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())["catch"](function(b){a(!1),console.log("Transaction rejected "+b)})}catch(b){a(!1),console.log(b)}}));case 4:case"end":return a.stop();}},a)}));return function setAllowance(){return a.apply(this,arguments)}}(),wrap:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d){var e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,trading.getGas();case 2:return e=a.sent,a.abrupt("return",new Promise(function(a){try{if(0==c)a(!0);else{window.web3StatusHandler("request_wrap");var f=_ethers.ethers.utils.bigNumberify(c),g={value:f,gasPrice:e},h=b.deposit(g);h.then(/*#__PURE__*/function(){var b=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function b(c){var e;return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return window.web3StatusHandler("send_wrap",c.hash),b.next=3,_utility["default"].waitForReceipt(c.hash,d);case 3:e=b.sent,window.web3StatusHandler("mined_wrap",c.hash),a(!0);case 6:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())["catch"](function(){a(!1)})}}catch(b){a(!1),console.log(b)}}));case 4:case"end":return a.stop();}},a)}));return function wrap(){return a.apply(this,arguments)}}(),unwrap:function unwrap(a,b){return new Promise(function(c){try{if(0==b)c(!0);else{var d=a.withdraw(b);d.then(function(a){console.log(a),_utility["default"].waitForReceipt(a.hash,function(){c(!0)})})["catch"](function(){c(!1)})}}catch(a){c(!1),console.log(a)}})},getTrade:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.to,d=b.from,e=b.amount,f=b.dex,a.abrupt("return",new Promise(function(a){try{fetch("https://api.dex.ag/trade?from=".concat(d,"&to=").concat(c,"&toAmount=").concat(e,"&dex=").concat(f||"best"),{headers:{Accept:"application/json"}}).then(function(a){return a.json()}).then(function(b){a(b)})}catch(b){a("err"),console.log("api error")}}));case 2:case"end":return a.stop();}},a)}));return function getTrade(){return a.apply(this,arguments)}}(),getPrice:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.to,d=b.from,e=b.amount,f=b.dex,a.abrupt("return",new Promise(function(a){try{fetch("https://api.dex.ag/price?from=".concat(d,"&to=").concat(c,"&toAmount=").concat(e,"&dex=").concat(f||"all"),{headers:{Accept:"application/json"}}).then(function(a){return a.json()}).then(function(b){a(b)})}catch(b){a("err"),console.log("api error")}}));case 2:case"end":return a.stop();}},a)}));return function getPrice(){return a.apply(this,arguments)}}()},_default=trading;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy90cmFkaW5nLmpzIl0sIm5hbWVzIjpbInRyYWRpbmciLCJnZXRHYXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsImRhdGEiLCJldGhlcnMiLCJ1dGlscyIsImJpZ051bWJlcmlmeSIsIndlYjMiLCJ0b1dlaSIsImZhc3QiLCJlcnIiLCJzZXRBbGxvd2FuY2UiLCJ0b2tlbkNvbnRyYWN0IiwiZXhjaGFuZ2VBZGRyZXNzIiwicHJvdmlkZXIiLCJmYXN0X2dhcyIsImNvbnNvbGUiLCJsb2ciLCJwcm9taXNlIiwiZnVuY3Rpb25zIiwiYXBwcm92ZSIsImdhc1ByaWNlIiwic3RhdHVzIiwid2luZG93Iiwid2ViM1N0YXR1c0hhbmRsZXIiLCJoYXNoIiwidXRpbGl0eSIsIndhaXRGb3JSZWNlaXB0IiwicmVjZWlwdCIsImUiLCJ3cmFwIiwid2V0aENvbnRyYWN0IiwiYW1vdW50IiwidmFsdWUiLCJ0eE9wdGlvbnMiLCJkZXBvc2l0IiwidW53cmFwIiwid2l0aGRyYXciLCJnZXRUcmFkZSIsInRvIiwiZnJvbSIsImRleCIsImhlYWRlcnMiLCJnZXRQcmljZSJdLCJtYXBwaW5ncyI6ImlkQU1NQSxPQUFPLENBQUcsQ0FDZEMsTUFBTSw4RkFBRSwwSEFDQyxHQUFJQyxDQUFBQSxPQUFKLENBQVksU0FBQUMsQ0FBTyxDQUFJLENBQzVCLEdBQUksQ0FDRkMsS0FBSyxDQUFDLGdEQUFELENBQUwsQ0FDQ0MsSUFERCxDQUNNLFNBQUFDLENBQVEsUUFBSUEsQ0FBQUEsQ0FBUSxDQUFDQyxJQUFULEVBQUosQ0FEZCxFQUVDRixJQUZELENBRU0sU0FBQUcsQ0FBSSxDQUFJLENBQ1pMLENBQU8sQ0FBQ00sZUFBT0MsS0FBUCxDQUFhQyxZQUFiLENBQTBCQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0wsQ0FBSSxDQUFDTSxJQUFMLENBQVksRUFBdkIsQ0FBMkIsTUFBM0IsQ0FBMUIsQ0FBRCxDQUNS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QUFDLENBQVEsUUFBSUEsQ0FBQUEsQ0FBUSxDQUFDQyxJQUFULEVBQUosQ0FEZCxFQUVDRixJQUZELENBRU0sU0FBQUcsQ0FBSSxDQUFJLENBQ1pMLENBQU8sQ0FBQ0ssQ0FBRCxDQUNSLENBSkQsQ0FLRCxDQUFDLE1BQU9PLENBQVAsQ0FBWSxDQUVaWixDQUFPLENBQUMsS0FBRCxDQUZLLENBR1prQixPQUFPLENBQUNDLEdBQVIsQ0FBWSxXQUFaLENBQ0QsQ0FDRixDQVpNLENBREMseUNBQUYsZ0VBakdNLENBZ0hkMEIsUUFBUSw4RkFBRSxvSEFBUUosQ0FBQUEsQ0FBUixHQUFRQSxFQUFSLENBQVlDLENBQVosR0FBWUEsSUFBWixDQUFrQlIsQ0FBbEIsR0FBa0JBLE1BQWxCLENBQTBCUyxDQUExQixHQUEwQkEsR0FBMUIsbUJBQ0QsR0FBSTVDLENBQUFBLE9BQUosQ0FBWSxTQUFBQyxDQUFPLENBQUksQ0FDNUIsR0FBSSxDQUNGQyxLQUFLLHlDQUFrQ3lDLENBQWxDLGdCQUE2Q0QsQ0FBN0Msc0JBQTREUCxDQUE1RCxpQkFBMEVTLENBQUcsRUFBRSxLQUEvRSxFQUF3RixDQUFFQyxPQUFPLENBQUUsQ0FBQyxPQUFVLGtCQUFYLENBQVgsQ0FBeEYsQ0FBTCxDQUNDMUMsSUFERCxDQUNNLFNBQUFDLENBQVEsUUFBSUEsQ0FBQUEsQ0FBUSxDQUFDQyxJQUFULEVBQUosQ0FEZCxFQUVDRixJQUZELENBRU0sU0FBQUcsQ0FBSSxDQUFJLENBQ1pMLENBQU8sQ0FBQ0ssQ0FBRCxDQUNSLENBSkQsQ0FLRCxDQUFDLE1BQU9PLENBQVAsQ0FBWSxDQUVaWixDQUFPLENBQUMsS0FBRCxDQUZLLENBR1prQixPQUFPLENBQUNDLEdBQVIsQ0FBWSxXQUFaLENBQ0QsQ0FDRixDQVpNLENBREMseUNBQUYsZ0VBaEhNLEMsVUFpSUR0QixPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXRoZXJzIH0gZnJvbSAnZXRoZXJzJztcblxuaW1wb3J0IHV0aWxpdHkgZnJvbSAnLi91dGlsaXR5JztcbmltcG9ydCB7IEJpZ051bWJlciBhcyBCTiB9IGZyb20gJ2JpZ251bWJlci5qcyc7XG5cblxuY29uc3QgdHJhZGluZyA9IHtcbiAgZ2V0R2FzOiBhc3luYyAoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZmV0Y2goJ2h0dHBzOi8vZXRoZ2Fzc3RhdGlvbi5pbmZvL2pzb24vZXRoZ2FzQVBJLmpzb24nKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgIHJlc29sdmUoZXRoZXJzLnV0aWxzLmJpZ051bWJlcmlmeSh3ZWIzLnRvV2VpKGRhdGEuZmFzdCAvIDEwLCAnZ3dlaScpKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIGRlZmF1bHQgdG8gNSBpZiBlcnJvclxuICAgICAgICByZXNvbHZlKGV0aGVycy51dGlscy5iaWdOdW1iZXJpZnkod2ViMy50b1dlaSg1LCAnZ3dlaScpKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIHNldEFsbG93YW5jZTogYXN5bmModG9rZW5Db250cmFjdCwgZXhjaGFuZ2VBZGRyZXNzLCBwcm92aWRlcikgPT4ge1xuICAgIGNvbnN0IGZhc3RfZ2FzID0gYXdhaXQgdHJhZGluZy5nZXRHYXMoKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1aW50TWF4ID0gJzExNTc5MjA4OTIzNzMxNjE5NTQyMzU3MDk4NTAwODY4NzkwNzg1MzI2OTk4NDY2NTY0MDU2NDAzOTQ1NzU4NDAwNzkxMzEyOTYzOTkzNSc7XG4gICAgICAgIGNvbnNvbGUubG9nKGZhc3RfZ2FzKTtcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9IHRva2VuQ29udHJhY3QuZnVuY3Rpb25zLmFwcHJvdmUoZXhjaGFuZ2VBZGRyZXNzLCB1aW50TWF4LCB7Z2FzUHJpY2U6IGZhc3RfZ2FzfSk7XG5cbiAgICAgICAgcHJvbWlzZS50aGVuKGFzeW5jIGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdzZW5kX3RyYWRlJywgc3RhdHVzLmhhc2gpO1xuICAgICAgICAgIC8vIHdhaXQgZm9yIG1pbmluZyB0byBmaW5pc2hcbiAgICAgICAgICBjb25zdCByZWNlaXB0ID0gYXdhaXQgdXRpbGl0eS53YWl0Rm9yUmVjZWlwdChzdGF0dXMuaGFzaCwgcHJvdmlkZXIpO1xuICAgICAgICAgIC8vIG1pbmVkXG4gICAgICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdtaW5lZF9hcHByb3ZlJywgc3RhdHVzLmhhc2gpO1xuICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdUcmFuc2FjdGlvbiByZWplY3RlZCAnICsgZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgd3JhcDogYXN5bmMod2V0aENvbnRyYWN0LCBhbW91bnQsIHByb3ZpZGVyKSA9PiB7XG4gICAgY29uc3QgZmFzdF9nYXMgPSBhd2FpdCB0cmFkaW5nLmdldEdhcygpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGFtb3VudCA9PSAwKSB7XG4gICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBzaG93IHdyYXAgaW5pdCBtZXNzYWdlXG4gICAgICAgIHdpbmRvdy53ZWIzU3RhdHVzSGFuZGxlcigncmVxdWVzdF93cmFwJyk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZXRoZXJzLnV0aWxzLmJpZ051bWJlcmlmeShhbW91bnQpO1xuICAgICAgICBjb25zdCB0eE9wdGlvbnMgPSB7XG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgZ2FzUHJpY2U6IGZhc3RfZ2FzXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB3ZXRoQ29udHJhY3QuZGVwb3NpdCh0eE9wdGlvbnMpO1xuXG4gICAgICAgIC8vIHdyYXAgc2VudFxuICAgICAgICBwcm9taXNlLnRoZW4oYXN5bmMgZnVuY3Rpb24oc3RhdHVzKSB7XG4gICAgICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdzZW5kX3dyYXAnLCBzdGF0dXMuaGFzaCk7XG4gICAgICAgICAgY29uc3QgcmVjZWlwdCA9IGF3YWl0IHV0aWxpdHkud2FpdEZvclJlY2VpcHQoc3RhdHVzLmhhc2gsIHByb3ZpZGVyKTtcbiAgICAgICAgICAvLyB3cmFwIG1pbmVkXG4gICAgICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdtaW5lZF93cmFwJywgc3RhdHVzLmhhc2gpO1xuICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgdW53cmFwOiAod2V0aENvbnRyYWN0LCBhbW91bnQpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoYW1vdW50ID09IDApIHtcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHByb21pc2UgPSB3ZXRoQ29udHJhY3Qud2l0aGRyYXcoYW1vdW50KTtcblxuICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbihzdGF0dXMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgICB1dGlsaXR5LndhaXRGb3JSZWNlaXB0KHN0YXR1cy5oYXNoLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIGdldFRyYWRlOiBhc3luYyAoe3RvLCBmcm9tLCBhbW91bnQsIGRleH0pID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBmZXRjaChgaHR0cHM6Ly9hcGkuZGV4LmFnL3RyYWRlP2Zyb209JHtmcm9tfSZ0bz0ke3RvfSZ0b0Ftb3VudD0ke2Ftb3VudH0mZGV4PSR7ZGV4fHwnYmVzdCd9YCwgeyBoZWFkZXJzOiB7J0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJ30gfSlcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuICAgICAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBkZWZhdWx0IHRvIDUgaWYgZXJyb3JcbiAgICAgICAgcmVzb2x2ZSgnZXJyJylcbiAgICAgICAgY29uc29sZS5sb2coJ2FwaSBlcnJvcicpXG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIGdldFByaWNlOiBhc3luYyAoe3RvLCBmcm9tLCBhbW91bnQsIGRleH0pID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBmZXRjaChgaHR0cHM6Ly9hcGkuZGV4LmFnL3ByaWNlP2Zyb209JHtmcm9tfSZ0bz0ke3RvfSZ0b0Ftb3VudD0ke2Ftb3VudH0mZGV4PSR7ZGV4fHwnYWxsJ31gLCB7IGhlYWRlcnM6IHsnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nfSB9KVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIGRlZmF1bHQgdG8gNSBpZiBlcnJvclxuICAgICAgICByZXNvbHZlKCdlcnInKVxuICAgICAgICBjb25zb2xlLmxvZygnYXBpIGVycm9yJylcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgdHJhZGluZztcbiJdfQ==