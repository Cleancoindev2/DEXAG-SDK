"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_ethers=require("ethers"),_utility=_interopRequireDefault(require("./utility")),_bignumber=require("bignumber.js"),trading={getGas:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a){try{fetch("https://ethgasstation.info/json/ethgasAPI.json").then(function(a){return a.json()}).then(function(b){a(_ethers.ethers.utils.bigNumberify(web3.toWei(b.fast/10,"gwei")))})}catch(b){// default to 5 if error
a(_ethers.ethers.utils.bigNumberify(web3.toWei(5,"gwei")))}}));case 1:case"end":return a.stop();}},a)}));return function getGas(){return a.apply(this,arguments)}}(),setAllowance:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c){var d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,trading.getGas();case 2:return d=a.sent,a.abrupt("return",new Promise(function(a){try{console.log(d);var e=b.functions.approve(c,"115792089237316195423570985008687907853269984665640564039457584007913129639935",{gasPrice:d});e.then(function(b){console.log(b),window.web3StatusHandler("send_trade",b.hash),_utility["default"].waitForReceipt(b.hash,function(){window.web3StatusHandler("mined_approve",b.hash),a(!0)})})["catch"](function(b){a(!1),console.log("Transaction rejected "+b)})}catch(b){a(!1),console.log(b)}}));case 4:case"end":return a.stop();}},a)}));return function setAllowance(){return a.apply(this,arguments)}}(),wrap:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c){var d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,trading.getGas();case 2:return d=a.sent,a.abrupt("return",new Promise(function(a){try{if(0==c)a(!0);else{window.web3StatusHandler("request_wrap");var e=_ethers.ethers.utils.bigNumberify(c),f={value:e,gasPrice:d},g=b.deposit(f);g.then(function(b){window.web3StatusHandler("send_wrap",b.hash),_utility["default"].waitForReceipt(b.hash,function(){window.web3StatusHandler("mined_wrap",b.hash),a(!0)})})["catch"](function(){a(!1)})}}catch(b){a(!1),console.log(b)}}));case 4:case"end":return a.stop();}},a)}));return function wrap(){return a.apply(this,arguments)}}(),unwrap:function unwrap(a,b){return new Promise(function(c){try{if(0==b)c(!0);else{var d=a.withdraw(b);d.then(function(a){console.log(a),_utility["default"].waitForReceipt(a.hash,function(){c(!0)})})["catch"](function(){c(!1)})}}catch(a){c(!1),console.log(a)}})},getTrade:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.to,d=b.from,e=b.amount,f=b.dex,a.abrupt("return",new Promise(function(a){try{fetch("https://api.dex.ag/trade?from=".concat(d,"&to=").concat(c,"&toAmount=").concat(e,"&dex=").concat(f||"best"),{headers:{Accept:"application/json"}}).then(function(a){return a.json()}).then(function(b){a(b)})}catch(b){a("err"),console.log("api error")}}));case 2:case"end":return a.stop();}},a)}));return function getTrade(){return a.apply(this,arguments)}}(),getPrice:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.to,d=b.from,e=b.amount,f=b.dex,a.abrupt("return",new Promise(function(a){try{fetch("https://api.dex.ag/price?from=".concat(d,"&to=").concat(c,"&toAmount=").concat(e,"&dex=").concat(f||"all"),{headers:{Accept:"application/json"}}).then(function(a){return a.json()}).then(function(b){a(b)})}catch(b){a("err"),console.log("api error")}}));case 2:case"end":return a.stop();}},a)}));return function getPrice(){return a.apply(this,arguments)}}()},_default=trading;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy90cmFkaW5nLmpzIl0sIm5hbWVzIjpbInRyYWRpbmciLCJnZXRHYXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsImRhdGEiLCJldGhlcnMiLCJ1dGlscyIsImJpZ051bWJlcmlmeSIsIndlYjMiLCJ0b1dlaSIsImZhc3QiLCJlcnIiLCJzZXRBbGxvd2FuY2UiLCJ0b2tlbkNvbnRyYWN0IiwiZXhjaGFuZ2VBZGRyZXNzIiwiZmFzdF9nYXMiLCJjb25zb2xlIiwibG9nIiwicHJvbWlzZSIsImZ1bmN0aW9ucyIsImFwcHJvdmUiLCJnYXNQcmljZSIsInN0YXR1cyIsIndpbmRvdyIsIndlYjNTdGF0dXNIYW5kbGVyIiwiaGFzaCIsInV0aWxpdHkiLCJ3YWl0Rm9yUmVjZWlwdCIsImUiLCJ3cmFwIiwid2V0aENvbnRyYWN0IiwiYW1vdW50IiwidmFsdWUiLCJ0eE9wdGlvbnMiLCJkZXBvc2l0IiwidW53cmFwIiwid2l0aGRyYXciLCJnZXRUcmFkZSIsInRvIiwiZnJvbSIsImRleCIsImhlYWRlcnMiLCJnZXRQcmljZSJdLCJtYXBwaW5ncyI6ImlkQU1NQSxPQUFPLENBQUcsQ0FDZEMsTUFBTSw4RkFBRSwwSEFDQyxHQUFJQyxDQUFBQSxPQUFKLENBQVksU0FBQUMsQ0FBTyxDQUFJLENBQzVCLEdBQUksQ0FDRkMsS0FBSyxDQUFDLGdEQUFELENBQUwsQ0FDQ0MsSUFERCxDQUNNLFNBQUFDLENBQVEsUUFBSUEsQ0FBQUEsQ0FBUSxDQUFDQyxJQUFULEVBQUosQ0FEZCxFQUVDRixJQUZELENBRU0sU0FBQUcsQ0FBSSxDQUFJLENBQ1pMLENBQU8sQ0FBQ00sZUFBT0MsS0FBUCxDQUFhQyxZQUFiLENBQTBCQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0wsQ0FBSSxDQUFDTSxJQUFMLENBQVksRUFBdkIsQ0FBMkIsTUFBM0IsQ0FBMUIsQ0FBRCxDQUNSLENBSkQsQ0FLRCxDQUFDLE1BQU9D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QUVNLFNBQUFHLENBQUksQ0FBSSxDQUNaTCxDQUFPLENBQUNLLENBQUQsQ0FDUixDQUpELENBS0QsQ0FBQyxNQUFPTyxDQUFQLENBQVksQ0FFWlosQ0FBTyxDQUFDLEtBQUQsQ0FGSyxDQUdaaUIsT0FBTyxDQUFDQyxHQUFSLENBQVksV0FBWixDQUNELENBQ0YsQ0FaTSxDQURDLHlDQUFGLGdFQWxHTSxDQWlIZHlCLFFBQVEsOEZBQUUsb0hBQVFKLENBQUFBLENBQVIsR0FBUUEsRUFBUixDQUFZQyxDQUFaLEdBQVlBLElBQVosQ0FBa0JSLENBQWxCLEdBQWtCQSxNQUFsQixDQUEwQlMsQ0FBMUIsR0FBMEJBLEdBQTFCLG1CQUNELEdBQUkxQyxDQUFBQSxPQUFKLENBQVksU0FBQUMsQ0FBTyxDQUFJLENBQzVCLEdBQUksQ0FDRkMsS0FBSyx5Q0FBa0N1QyxDQUFsQyxnQkFBNkNELENBQTdDLHNCQUE0RFAsQ0FBNUQsaUJBQTBFUyxDQUFHLEVBQUUsS0FBL0UsRUFBd0YsQ0FBRUMsT0FBTyxDQUFFLENBQUMsT0FBVSxrQkFBWCxDQUFYLENBQXhGLENBQUwsQ0FDQ3hDLElBREQsQ0FDTSxTQUFBQyxDQUFRLFFBQUlBLENBQUFBLENBQVEsQ0FBQ0MsSUFBVCxFQUFKLENBRGQsRUFFQ0YsSUFGRCxDQUVNLFNBQUFHLENBQUksQ0FBSSxDQUNaTCxDQUFPLENBQUNLLENBQUQsQ0FDUixDQUpELENBS0QsQ0FBQyxNQUFPTyxDQUFQLENBQVksQ0FFWlosQ0FBTyxDQUFDLEtBQUQsQ0FGSyxDQUdaaUIsT0FBTyxDQUFDQyxHQUFSLENBQVksV0FBWixDQUNELENBQ0YsQ0FaTSxDQURDLHlDQUFGLGdFQWpITSxDLFVBa0lEckIsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV0aGVycyB9IGZyb20gJ2V0aGVycyc7XG5cbmltcG9ydCB1dGlsaXR5IGZyb20gJy4vdXRpbGl0eSc7XG5pbXBvcnQgeyBCaWdOdW1iZXIgYXMgQk4gfSBmcm9tICdiaWdudW1iZXIuanMnO1xuXG5cbmNvbnN0IHRyYWRpbmcgPSB7XG4gIGdldEdhczogYXN5bmMgKCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGZldGNoKCdodHRwczovL2V0aGdhc3N0YXRpb24uaW5mby9qc29uL2V0aGdhc0FQSS5qc29uJylcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuICAgICAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgICByZXNvbHZlKGV0aGVycy51dGlscy5iaWdOdW1iZXJpZnkod2ViMy50b1dlaShkYXRhLmZhc3QgLyAxMCwgJ2d3ZWknKSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBkZWZhdWx0IHRvIDUgaWYgZXJyb3JcbiAgICAgICAgcmVzb2x2ZShldGhlcnMudXRpbHMuYmlnTnVtYmVyaWZ5KHdlYjMudG9XZWkoNSwgJ2d3ZWknKSkpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBzZXRBbGxvd2FuY2U6IGFzeW5jKHRva2VuQ29udHJhY3QsIGV4Y2hhbmdlQWRkcmVzcykgPT4ge1xuICAgIGNvbnN0IGZhc3RfZ2FzID0gYXdhaXQgdHJhZGluZy5nZXRHYXMoKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1aW50TWF4ID0gJzExNTc5MjA4OTIzNzMxNjE5NTQyMzU3MDk4NTAwODY4NzkwNzg1MzI2OTk4NDY2NTY0MDU2NDAzOTQ1NzU4NDAwNzkxMzEyOTYzOTkzNSc7XG4gICAgICAgIGNvbnNvbGUubG9nKGZhc3RfZ2FzKTtcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9IHRva2VuQ29udHJhY3QuZnVuY3Rpb25zLmFwcHJvdmUoZXhjaGFuZ2VBZGRyZXNzLCB1aW50TWF4LCB7Z2FzUHJpY2U6IGZhc3RfZ2FzfSk7XG5cbiAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdzZW5kX3RyYWRlJywgc3RhdHVzLmhhc2gpO1xuXG4gICAgICAgICAgdXRpbGl0eS53YWl0Rm9yUmVjZWlwdChzdGF0dXMuaGFzaCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB3aW5kb3cud2ViM1N0YXR1c0hhbmRsZXIoJ21pbmVkX2FwcHJvdmUnLCBzdGF0dXMuaGFzaCk7XG4gICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnVHJhbnNhY3Rpb24gcmVqZWN0ZWQgJyArIGVycik7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIHdyYXA6IGFzeW5jKHdldGhDb250cmFjdCwgYW1vdW50KSA9PiB7XG4gICAgY29uc3QgZmFzdF9nYXMgPSBhd2FpdCB0cmFkaW5nLmdldEdhcygpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGFtb3VudCA9PSAwKSB7XG4gICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBzaG93IHdyYXAgaW5pdCBtZXNzYWdlXG4gICAgICAgIHdpbmRvdy53ZWIzU3RhdHVzSGFuZGxlcigncmVxdWVzdF93cmFwJyk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZXRoZXJzLnV0aWxzLmJpZ051bWJlcmlmeShhbW91bnQpO1xuICAgICAgICBjb25zdCB0eE9wdGlvbnMgPSB7XG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgZ2FzUHJpY2U6IGZhc3RfZ2FzXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB3ZXRoQ29udHJhY3QuZGVwb3NpdCh0eE9wdGlvbnMpO1xuXG4gICAgICAgIC8vIHdyYXAgc2VudFxuICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24oc3RhdHVzKSB7XG4gICAgICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdzZW5kX3dyYXAnLCBzdGF0dXMuaGFzaCk7XG4gICAgICAgICAgdXRpbGl0eS53YWl0Rm9yUmVjZWlwdChzdGF0dXMuaGFzaCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyB3cmFwIG1pbmVkXG4gICAgICAgICAgICB3aW5kb3cud2ViM1N0YXR1c0hhbmRsZXIoJ21pbmVkX3dyYXAnLCBzdGF0dXMuaGFzaCk7XG4gICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICB9XG4gICAgfSk7XG4gIH0sXG4gIHVud3JhcDogKHdldGhDb250cmFjdCwgYW1vdW50KSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKGFtb3VudCA9PSAwKSB7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBwcm9taXNlID0gd2V0aENvbnRyYWN0LndpdGhkcmF3KGFtb3VudCk7XG5cbiAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24oc3RhdHVzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzdGF0dXMpO1xuICAgICAgICAgICAgdXRpbGl0eS53YWl0Rm9yUmVjZWlwdChzdGF0dXMuaGFzaCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBnZXRUcmFkZTogYXN5bmMgKHt0bywgZnJvbSwgYW1vdW50LCBkZXh9KSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZmV0Y2goYGh0dHBzOi8vYXBpLmRleC5hZy90cmFkZT9mcm9tPSR7ZnJvbX0mdG89JHt0b30mdG9BbW91bnQ9JHthbW91bnR9JmRleD0ke2RleHx8J2Jlc3QnfWAsIHsgaGVhZGVyczogeydBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbid9IH0pXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZShkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gZGVmYXVsdCB0byA1IGlmIGVycm9yXG4gICAgICAgIHJlc29sdmUoJ2VycicpXG4gICAgICAgIGNvbnNvbGUubG9nKCdhcGkgZXJyb3InKVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBnZXRQcmljZTogYXN5bmMgKHt0bywgZnJvbSwgYW1vdW50LCBkZXh9KSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZmV0Y2goYGh0dHBzOi8vYXBpLmRleC5hZy9wcmljZT9mcm9tPSR7ZnJvbX0mdG89JHt0b30mdG9BbW91bnQ9JHthbW91bnR9JmRleD0ke2RleHx8J2FsbCd9YCwgeyBoZWFkZXJzOiB7J0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJ30gfSlcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuICAgICAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBkZWZhdWx0IHRvIDUgaWYgZXJyb3JcbiAgICAgICAgcmVzb2x2ZSgnZXJyJylcbiAgICAgICAgY29uc29sZS5sb2coJ2FwaSBlcnJvcicpXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IHRyYWRpbmc7XG4iXX0=