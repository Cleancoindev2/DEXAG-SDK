"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_ethers=require("ethers"),_erc=_interopRequireDefault(require("../../abi/erc20.json")),_weth=_interopRequireDefault(require("../../abi/weth.json")),utility={promisify:function promisify(a){return new Promise(function(b,c){a(function(a,d){a?c(a):b(d)})})},waitForReceipt:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c){var d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:d=null;case 1:if(d){a.next=9;break}return a.next=4,c.getTransactionReceipt(b);case 4:return d=a.sent,a.next=7,utility.sleep(2e3);case 7:a.next=1;break;case 9:return a.abrupt("return",d);case 10:case"end":return a.stop();}},a)}));return function waitForReceipt(){return a.apply(this,arguments)}}(),getTokenContract:function getTokenContract(a,b){var c=a.metadata.input.address;return new _ethers.ethers.Contract(c,_erc["default"],b)},getWethContract:function getWethContract(a){return new _ethers.ethers.Contract("0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",_weth["default"],a)},getEtherToWrap:function getEtherToWrap(a,b,c){if(!a.metadata.input)return 0;if("0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"!=a.metadata.input.address)return 0;var d,e,f=a.metadata.input.amount,g=new _ethers.ethers.Contract("0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",_erc["default"],c),h=c.getAddress().then(function(a){return d=a,g.balanceOf(d)}).then(function(a){return e=a,b.getBalance(d)}).then(function(a){if(e.gte(f))// Enough weth, no need to wrap
return 0;var b=a.add(e);if(b.lt(f))// Insufficient balance
return-1;// eth to wrap = weth required for trade - weth balance
var c=e.sub(f).mul(-1);return c.toString()});return h},handleReceipt:function handleReceipt(a,b){"0x1"==b.status?window.web3StatusHandler("mined_trade",a.hash):window.web3StatusHandler("failed",a.hash)},track:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch("https://api.dex.ag/send_trade",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({status:b,details:c,trade:d})});case 2:a.sent;case 3:case"end":return a.stop();}},a)}));return function track(){return a.apply(this,arguments)}}(),sleep:function sleep(a){return new Promise(function(b){return setTimeout(b,a)})}},_default=utility;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy91dGlsaXR5LmpzIl0sIm5hbWVzIjpbInV0aWxpdHkiLCJwcm9taXNpZnkiLCJpbm5lciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZXJyIiwicmVzIiwid2FpdEZvclJlY2VpcHQiLCJoYXNoIiwicHJvdmlkZXIiLCJyZWNlaXB0IiwiZ2V0VHJhbnNhY3Rpb25SZWNlaXB0Iiwic2xlZXAiLCJnZXRUb2tlbkNvbnRyYWN0IiwidHJhZGUiLCJzaWduZXIiLCJ0b2tlbkFkZHJlc3MiLCJtZXRhZGF0YSIsImlucHV0IiwiYWRkcmVzcyIsImV0aGVycyIsIkNvbnRyYWN0IiwiZXJjMjBBYmkiLCJnZXRXZXRoQ29udHJhY3QiLCJ3ZXRoQWJpIiwiZ2V0RXRoZXJUb1dyYXAiLCJhY2NvdW50QWRkcmVzcyIsIndldGhCYWxhbmNlIiwid2V0aEFtb3VudCIsImFtb3VudCIsIndldGhDb250cmFjdCIsImVub3VnaFdldGgiLCJnZXRBZGRyZXNzIiwidGhlbiIsImJhbGFuY2VPZiIsImJhbGFuY2UiLCJnZXRCYWxhbmNlIiwiZ3RlIiwidG90YWxCYWxhbmNlIiwiYWRkIiwibHQiLCJldGhUb1dyYXAiLCJzdWIiLCJtdWwiLCJ0b1N0cmluZyIsImhhbmRsZVJlY2VpcHQiLCJzdGF0dXMiLCJ3aW5kb3ciLCJ3ZWIzU3RhdHVzSGFuZGxlciIsInRyYWNrIiwiZGV0YWlscyIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwibXMiLCJzZXRUaW1lb3V0Il0sIm1hcHBpbmdzIjoia2ZBS01BLE9BQU8sQ0FBRyxDQUNkQyxTQUFTLENBQUUsbUJBQUNDLENBQUQsQ0FBVyxDQUNwQixNQUFPLElBQUlDLENBQUFBLE9BQUosQ0FBWSxTQUFDQyxDQUFELENBQVVDLENBQVYsQ0FBcUIsQ0FDdENILENBQUssQ0FBQyxTQUFDSSxDQUFELENBQU1DLENBQU4sQ0FBYyxDQUNkRCxDQURjLENBRWhC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dEMsSUFBMUMsQ0FFSCxDQXZFYSxDQXdFZHlDLEtBQUssOEZBQUUsV0FBTUgsQ0FBTixDQUFjSSxDQUFkLENBQXVCcEMsQ0FBdkIsc0dBQ2tCcUMsS0FBSyxDQUFDLCtCQUFELENBQWtDLENBQzVEQyxNQUFNLENBQUUsTUFEb0QsQ0FFNURDLE9BQU8sQ0FBRSxDQUNQLE9BQVUsa0JBREgsQ0FFUCxlQUFnQixrQkFGVCxDQUZtRCxDQU01REMsSUFBSSxDQUFFQyxJQUFJLENBQUNDLFNBQUwsQ0FBZSxDQUFDVixNQUFNLENBQU5BLENBQUQsQ0FBU0ksT0FBTyxDQUFQQSxDQUFULENBQWtCcEMsS0FBSyxDQUFMQSxDQUFsQixDQUFmLENBTnNELENBQWxDLENBRHZCLHNEQUFGLDZEQXhFUyxDQWtGZEYsS0FBSyxDQUFFLGVBQUM2QyxDQUFELENBQU8sQ0FDWixNQUFPLElBQUl2RCxDQUFBQSxPQUFKLENBQVksU0FBQUMsQ0FBTyxRQUFJdUQsQ0FBQUEsVUFBVSxDQUFDdkQsQ0FBRCxDQUFVc0QsQ0FBVixDQUFkLENBQW5CLENBQ1IsQ0FwRmEsQyxVQXVGRDFELE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBldGhlcnMgfSBmcm9tICdldGhlcnMnO1xuXG5pbXBvcnQgZXJjMjBBYmkgZnJvbSAnLi4vLi4vYWJpL2VyYzIwLmpzb24nO1xuaW1wb3J0IHdldGhBYmkgZnJvbSAnLi4vLi4vYWJpL3dldGguanNvbic7XG5cbmNvbnN0IHV0aWxpdHkgPSB7XG4gIHByb21pc2lmeTogKGlubmVyKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGlubmVyKChlcnIsIHJlcykgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcbiAgd2FpdEZvclJlY2VpcHQ6IGFzeW5jKGhhc2gsIHByb3ZpZGVyKSA9PiB7XG4gICAgbGV0IHJlY2VpcHQgPSBudWxsO1xuICAgIHdoaWxlICghcmVjZWlwdCkge1xuICAgICAgcmVjZWlwdCA9IGF3YWl0IHByb3ZpZGVyLmdldFRyYW5zYWN0aW9uUmVjZWlwdChoYXNoKTtcbiAgICAgIGF3YWl0IHV0aWxpdHkuc2xlZXAoMjAwMCk7XG4gICAgfVxuICAgIHJldHVybiByZWNlaXB0O1xuICB9LFxuICBnZXRUb2tlbkNvbnRyYWN0OiAodHJhZGUsIHNpZ25lcikgPT4ge1xuICAgIGNvbnN0IHRva2VuQWRkcmVzcyA9IHRyYWRlLm1ldGFkYXRhLmlucHV0LmFkZHJlc3M7XG4gICAgcmV0dXJuIG5ldyBldGhlcnMuQ29udHJhY3QodG9rZW5BZGRyZXNzLCBlcmMyMEFiaSwgc2lnbmVyKTtcbiAgfSxcbiAgZ2V0V2V0aENvbnRyYWN0OiAoc2lnbmVyKSA9PiB7XG4gICAgY29uc3Qgd2V0aFRva2VuQWRkcmVzcyA9ICcweGMwMmFhYTM5YjIyM2ZlOGQwYTBlNWM0ZjI3ZWFkOTA4M2M3NTZjYzInO1xuICAgIHJldHVybiBuZXcgZXRoZXJzLkNvbnRyYWN0KHdldGhUb2tlbkFkZHJlc3MsIHdldGhBYmksIHNpZ25lcik7XG4gIH0sXG4gIGdldEV0aGVyVG9XcmFwKHRyYWRlLCBwcm92aWRlciwgc2lnbmVyKSB7XG4gICAgY29uc3Qgd2V0aFRva2VuQWRkcmVzcyA9ICcweGMwMmFhYTM5YjIyM2ZlOGQwYTBlNWM0ZjI3ZWFkOTA4M2M3NTZjYzInO1xuICAgIGlmICghdHJhZGUubWV0YWRhdGEuaW5wdXQpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBpZiAodHJhZGUubWV0YWRhdGEuaW5wdXQuYWRkcmVzcyAhPSB3ZXRoVG9rZW5BZGRyZXNzKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3Qgd2V0aEFtb3VudCA9IHRyYWRlLm1ldGFkYXRhLmlucHV0LmFtb3VudDtcbiAgICBjb25zdCB3ZXRoQ29udHJhY3QgPSBuZXcgZXRoZXJzLkNvbnRyYWN0KHdldGhUb2tlbkFkZHJlc3MsIGVyYzIwQWJpLCBzaWduZXIpO1xuICAgIGxldCBhY2NvdW50QWRkcmVzcztcbiAgICBsZXQgd2V0aEJhbGFuY2U7XG4gICAgY29uc3QgZW5vdWdoV2V0aCA9IHNpZ25lci5nZXRBZGRyZXNzKClcbiAgICAudGhlbihhZGRyZXNzID0+IHtcbiAgICAgIGFjY291bnRBZGRyZXNzID0gYWRkcmVzcztcbiAgICAgIHJldHVybiB3ZXRoQ29udHJhY3QuYmFsYW5jZU9mKGFjY291bnRBZGRyZXNzKTtcbiAgICB9KVxuICAgIC50aGVuKGJhbGFuY2UgPT4ge1xuICAgICAgd2V0aEJhbGFuY2UgPSBiYWxhbmNlO1xuICAgICAgcmV0dXJuIHByb3ZpZGVyLmdldEJhbGFuY2UoYWNjb3VudEFkZHJlc3MpO1xuICAgIH0pXG4gICAgLnRoZW4oYmFsYW5jZSA9PiB7XG4gICAgICBpZiAod2V0aEJhbGFuY2UuZ3RlKHdldGhBbW91bnQpKSB7XG4gICAgICAgIC8vIEVub3VnaCB3ZXRoLCBubyBuZWVkIHRvIHdyYXBcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICBjb25zdCB0b3RhbEJhbGFuY2UgPSBiYWxhbmNlLmFkZCh3ZXRoQmFsYW5jZSk7XG4gICAgICBpZiAodG90YWxCYWxhbmNlLmx0KHdldGhBbW91bnQpKSB7XG4gICAgICAgIC8vIEluc3VmZmljaWVudCBiYWxhbmNlXG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIC8vIGV0aCB0byB3cmFwID0gd2V0aCByZXF1aXJlZCBmb3IgdHJhZGUgLSB3ZXRoIGJhbGFuY2VcbiAgICAgIGNvbnN0IGV0aFRvV3JhcCA9IHdldGhCYWxhbmNlLnN1Yih3ZXRoQW1vdW50KS5tdWwoLTEpO1xuICAgICAgcmV0dXJuIGV0aFRvV3JhcC50b1N0cmluZygpO1xuICAgIH0pO1xuICAgIHJldHVybiBlbm91Z2hXZXRoO1xuICB9LFxuICBoYW5kbGVSZWNlaXB0OiAoc3RhdHVzLCByZWNlaXB0KT0+IHtcbiAgICBpZihyZWNlaXB0LnN0YXR1cz09JzB4MScpe1xuICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdtaW5lZF90cmFkZScsIHN0YXR1cy5oYXNoKTtcbiAgICB9ZWxzZXtcbiAgICAgIHdpbmRvdy53ZWIzU3RhdHVzSGFuZGxlcignZmFpbGVkJywgc3RhdHVzLmhhc2gpO1xuICAgIH1cbiAgfSxcbiAgdHJhY2s6IGFzeW5jKHN0YXR1cywgZGV0YWlscywgdHJhZGUpPT57XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkuZGV4LmFnL3NlbmRfdHJhZGUnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtzdGF0dXMsIGRldGFpbHMsIHRyYWRlfSlcbiAgICB9KTtcbiAgfSxcbiAgc2xlZXA6IChtcyk9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCB1dGlsaXR5O1xuIl19