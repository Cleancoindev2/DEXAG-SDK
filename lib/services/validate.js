"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_utility=_interopRequireDefault(require("./utility")),_trading=_interopRequireDefault(require("./trading")),_account=_interopRequireDefault(require("./account")),validate={web3:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d){var e,f,g,h,i,j,k,l,m,n;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(window.web3StatusHandler("init"),null!=window.web3&&0!=Object.keys(window.web3).length){a.next=4;break}return window.web3StatusHandler("web3_undefined"),a.abrupt("return",!1);case 4:if(null!=window.web3&&null!=window.web3.eth.accounts[0]){a.next=14;break}return a.prev=5,a.next=8,window.ethereum.enable();case 8:a.next=14;break;case 10:return a.prev=10,a.t0=a["catch"](5),window.web3StatusHandler("connect_rejected"),a.abrupt("return",!1);case 14:if(null!=window.web3.eth.accounts[0]){a.next=17;break}return window.web3StatusHandler("unlock_wallet"),a.abrupt("return");case 17:if("No trades"!=b.error){a.next=19;break}return a.abrupt("return",!1);case 19:if(1==web3.version.network){a.next=22;break}return window.web3StatusHandler("network"),a.abrupt("return",!1);case 22:return a.next=24,_utility["default"].getEtherToWrap(b,c,d);case 24:if(e=a.sent,-1!=e){a.next=28;break}return window.web3StatusHandler("balance"),a.abrupt("return",!1);case 28:return f=_utility["default"].getWethContract(d),a.next=31,_trading["default"].wrap(f,e,c);case 31:if(g=a.sent,g){a.next=34;break}return a.abrupt("return",!1);case 34:if(a.prev=34,"ETH"==b.metadata.query.from){a.next=41;break}return a.next=38,_account["default"].getERC20Balance(b,c,d);case 38:h=a.sent,a.next=50;break;case 41:return a.prev=41,a.next=44,_account["default"].getETHBalance(b);case 44:h=a.sent,a.next=50;break;case 47:a.prev=47,a.t1=a["catch"](41),console.log(a.t1);case 50:a.next=55;break;case 52:a.prev=52,a.t2=a["catch"](34),console.log(a.t2);case 55:if(h){a.next=58;break}return window.web3StatusHandler("balance"),a.abrupt("return",!1);case 58:if(!b.metadata.input){a.next=75;break}return i=_utility["default"].getTokenContract(b,d),j=b.metadata.input.spender,a.next=63,c.getSigner().getAddress();case 63:return k=a.sent,a.next=66,i.allowance(k,j);case 66:if(l=a.sent,m=b.metadata.input.amount,!l.lt(m)){a.next=75;break}return window.web3StatusHandler("allowance"),a.next=72,_trading["default"].setAllowance(i,j,c);case 72:if(n=a.sent,n){a.next=75;break}return a.abrupt("return",!1);case 75:return a.abrupt("return",!0);case 76:case"end":return a.stop();}},a,null,[[5,10],[34,52],[41,47]])}));return function(){return a.apply(this,arguments)}}())},_default=validate;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy92YWxpZGF0ZS5qcyJdLCJuYW1lcyI6WyJ2YWxpZGF0ZSIsIndlYjMiLCJ0cmFkZSIsInByb3ZpZGVyIiwic2lnbmVyIiwid2luZG93Iiwid2ViM1N0YXR1c0hhbmRsZXIiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiZXRoIiwiYWNjb3VudHMiLCJldGhlcmV1bSIsImVuYWJsZSIsImVycm9yIiwidmVyc2lvbiIsIm5ldHdvcmsiLCJ1dGlsaXR5IiwiZ2V0RXRoZXJUb1dyYXAiLCJldGhlclRvV3JhcCIsIndldGhDb250cmFjdCIsImdldFdldGhDb250cmFjdCIsInRyYWRpbmciLCJ3cmFwIiwid3JhcHBpbmciLCJtZXRhZGF0YSIsInF1ZXJ5IiwiZnJvbSIsImFjY291bnQiLCJnZXRFUkMyMEJhbGFuY2UiLCJiYWxhbmNlIiwiZ2V0RVRIQmFsYW5jZSIsImNvbnNvbGUiLCJsb2ciLCJpbnB1dCIsInRva2VuQ29udHJhY3QiLCJnZXRUb2tlbkNvbnRyYWN0IiwiZXhjaGFuZ2VBZGRyZXNzIiwic3BlbmRlciIsImdldFNpZ25lciIsImdldEFkZHJlc3MiLCJhZGRyZXNzIiwiYWxsb3dhbmNlIiwidG9rZW5BbW91bnQiLCJhbW91bnQiLCJsdCIsInNldEFsbG93YW5jZSIsInRyYWRpbmdfYWxsb3dhbmNlIl0sIm1hcHBpbmdzIjoiZ2dCQUlNQSxRQUFRLENBQUcsQ0FDZkMsSUFBSSx3TkFBRSxXQUFPQyxDQUFQLENBQWNDLENBQWQsQ0FBd0JDLENBQXhCLGlIQUVKQyxNQUFNLENBQUNDLGlCQUFQLENBQXlCLE1BQXpCLENBRkksQ0FLQSxNQUFBRCxNQUFNLENBQUNKLElBQVAsRUFBK0QsQ0FBbkMsRUFBQU0sTUFBTSxDQUFDQyxJQUFQLENBQVlILE1BQU0sQ0FBQ0osSUFBbkIsRUFBeUJRLE1BTHJELHVCQU1GSixDQUFBQSxNQUFNLENBQUNDLGlCQUFQLENBQXlCLGdCQUF6QixDQU5FLGlDQVdBLE1BQUFELE1BQU0sQ0FBQ0osSUFBUCxFQUE0QixNQUFBSSxNQUFNLENBQUNKLElBQVAsQ0FBWVMsR0FBWixDQUFnQkMsUUFBaEIsQ0FBeUIsQ0FBekIsQ0FYNUIsMkNBYU1OLE1BQU0sQ0FBQ08sUUFBUCxDQUFnQkMsTUFBaEIsRUFiTixvRUFnQkFSLE1BQU0sQ0FBQ0MsaUJBQVAsQ0FBeUIsa0JBQXpCLENBaEJBLGtDQXNCRCxNQUFBRCxNQUFNLENBQUNKLElBQVAsQ0FBWVMsR0FBWixDQUFnQkMsUUFBaEIsQ0FBeUIsQ0FBekIsQ0F0QkMsd0JBdUJGTixDQUFBQSxNQUFNLENBQUNDLGlCQUFQLENBQXlCLGVBQXpCLENBdkJFLCtCQTRCZSxXQUFmLEVBQUFKLENBQUssQ0FBQ1ksS0E1Qk4sMERBZ0N3QixDQUF4QixFQUFBYixJQUFJLENBQUNjLE9BQUwsQ0FBYUMsT0FoQ2Isd0JBaUNGWCxDQUFBQSxNQUFNLENBQUNDLGlCQUFQLENBQXlCLFNBQXpCLENBakNFLGdEQXNDc0JXLG9CQUFRQyxjQUFSLENBQXVCaEIsQ0FBdkIsQ0FBOEJDLENBQTlCLENBQXdDQyxDQUF4QyxDQXRDdEIsWUFzQ0VlLENBdENGLFFBdUNlLENBQUMsQ0FBaEIsRUFBQUEsQ0F2Q0Esd0JBd0NGZCxDQUFBQSxNQUFNLENBQUNDLGlCQUFQLENBQXlCLFNBQXpCLENBeENFLHFDQTRDRWMsQ0FBQUEsQ0E1Q0YsQ0E0Q2lCSCxvQkFBUUksZUFBUixDQUF3QmpCLENBQXhCLENBNUNqQixXQTZDbUJrQixvQkFBUUMsSUFBUixDQUFhSCxDQUFiLENBQTJCRCxDQUEzQixDQUF3Q2hCLENBQXhDLENBN0NuQixZQTZDRXFCLENBN0NGLFFBOENDQSxDQTlDRCxvRUFtRDRCLEtBQTNCLEVBQUF0QixDQUFLLENBQUN1QixRQUFOLENBQWVDLEtBQWYsQ0FBcUJDLElBbkR0QixtQ0FxRGdCQyxvQkFBUUMsZUFBUixDQUF3QjNCLENBQXhCLENBQStCQyxDQUEvQixDQUF5Q0MsQ0FBekMsQ0FyRGhCLFNBcURBMEIsQ0FyREEsMkRBeURrQkYsb0JBQVFHLGFBQVIsQ0FBc0I3QixDQUF0QixDQXpEbEIsU0F5REU0QixDQXpERiw4REEyREVFLE9BQU8sQ0FBQ0MsR0FBUixNQTNERiwrREErREZELE9BQU8sQ0FBQ0MsR0FBUixNQS9ERSxZQWlFQ0gsQ0FqRUQsd0JBa0VGekIsQ0FBQUEsTUFBTSxDQUFDQyxpQkFBUCxDQUF5QixTQUF6QixDQWxFRSxtQ0FzRUFKLENBQUssQ0FBQ3VCLFFBQU4sQ0FBZVMsS0F0RWYsd0JBd0VJQyxDQUFBQSxDQXhFSixDQXdFb0JsQixvQkFBUW1CLGdCQUFSLENBQXlCbEMsQ0FBekIsQ0FBZ0NFLENBQWhDLENBeEVwQixDQXlFSWlDLENBekVKLENBeUVzQm5DLENBQUssQ0FBQ3VCLFFBQU4sQ0FBZVMsS0FBZixDQUFxQkksT0F6RTNDLFdBMkVvQm5DLENBQVEsQ0FBQ29DLFNBQVQsR0FBcUJDLFVBQXJCLEVBM0VwQixlQTJFSUMsQ0FBQUEsQ0EzRUosa0JBNkVzQk4sQ0FBYSxDQUFDTyxTQUFkLENBQXdCRCxDQUF4QixDQUFpQ0osQ0FBakMsQ0E3RXRCLFlBNkVJSyxDQTdFSixRQThFSUMsQ0E5RUosQ0E4RWtCekMsQ0FBSyxDQUFDdUIsUUFBTixDQUFlUyxLQUFmLENBQXFCVSxNQTlFdkMsRUFnRkVGLENBQVMsQ0FBQ0csRUFBVixDQUFhRixDQUFiLENBaEZGLHdCQWtGQXRDLENBQUFBLE1BQU0sQ0FBQ0MsaUJBQVAsQ0FBeUIsV0FBekIsQ0FsRkEsV0FtRmdDZ0Isb0JBQVF3QixZQUFSLENBQXFCWCxDQUFyQixDQUFvQ0UsQ0FBcEMsQ0FBcURsQyxDQUFyRCxDQW5GaEMsWUFtRk00QyxDQW5GTixRQXFGSUEsQ0FyRkosMEpBQUYsd0RBRFcsQyxVQThGRi9DLFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdXRpbGl0eSBmcm9tICcuL3V0aWxpdHknO1xuaW1wb3J0IHRyYWRpbmcgZnJvbSAnLi90cmFkaW5nJztcbmltcG9ydCBhY2NvdW50IGZyb20gJy4vYWNjb3VudCc7XG5cbmNvbnN0IHZhbGlkYXRlID0ge1xuICB3ZWIzOiBhc3luYyAodHJhZGUsIHByb3ZpZGVyLCBzaWduZXIpID0+IHtcblxuICAgIHdpbmRvdy53ZWIzU3RhdHVzSGFuZGxlcignaW5pdCcpO1xuXG4gICAgLy8gY2hlY2sgdGhhdCB3ZWIzIGV4aXN0c1xuICAgIGlmICh3aW5kb3cud2ViMyA9PSB1bmRlZmluZWQgfHwgT2JqZWN0LmtleXMod2luZG93LndlYjMpLmxlbmd0aCA9PSAwKSB7XG4gICAgICB3aW5kb3cud2ViM1N0YXR1c0hhbmRsZXIoJ3dlYjNfdW5kZWZpbmVkJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gYXNrIHVzZXIgdG8gdW5sb2NrIGFuZCBjb25uZWN0XG4gICAgaWYgKHdpbmRvdy53ZWIzID09IHVuZGVmaW5lZCB8fCB3aW5kb3cud2ViMy5ldGguYWNjb3VudHNbMF0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB3aW5kb3cuZXRoZXJldW0uZW5hYmxlKCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIHVzZXIgcmVqZWN0ZWQgc2NyZWVuXG4gICAgICAgIHdpbmRvdy53ZWIzU3RhdHVzSGFuZGxlcignY29ubmVjdF9yZWplY3RlZCcpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQXV0byB1bmxvY2sgZGlkbnQgd29yaywgd2FsbGV0IGlzIHN0aWxsIGxvY2tlZFxuICAgIGlmKHdpbmRvdy53ZWIzLmV0aC5hY2NvdW50c1swXSA9PSB1bmRlZmluZWQpe1xuICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCd1bmxvY2tfd2FsbGV0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgd2ViMyB0cmFkaW5nIGlzIHN1cHBvcnRlZCBmb3IgdGhpcyBkZXhcbiAgICBpZiAodHJhZGUuZXJyb3IgPT0gJ05vIHRyYWRlcycpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAod2ViMy52ZXJzaW9uLm5ldHdvcmsgIT0gMSkge1xuICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCduZXR3b3JrJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgaWYgZXRoZXIgYmFsYW5jZSBpcyBpbnN1ZmZpY2llbnRcbiAgICBjb25zdCBldGhlclRvV3JhcCA9IGF3YWl0IHV0aWxpdHkuZ2V0RXRoZXJUb1dyYXAodHJhZGUsIHByb3ZpZGVyLCBzaWduZXIpO1xuICAgIGlmIChldGhlclRvV3JhcCA9PSAtMSkge1xuICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdiYWxhbmNlJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIHdyYXAgZXRoZXIgaWYgbmVjZXNzYXJ5XG4gICAgY29uc3Qgd2V0aENvbnRyYWN0ID0gdXRpbGl0eS5nZXRXZXRoQ29udHJhY3Qoc2lnbmVyKTtcbiAgICBjb25zdCB3cmFwcGluZyA9IGF3YWl0IHRyYWRpbmcud3JhcCh3ZXRoQ29udHJhY3QsIGV0aGVyVG9XcmFwLCBwcm92aWRlcik7XG4gICAgaWYgKCF3cmFwcGluZykgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gQ2hlY2sgaWYgYmFsYW5jZSBpcyBpbnN1ZmZpY2llbnRcbiAgICBsZXQgYmFsYW5jZTtcbiAgICB0cnl7XG4gICAgICBpZih0cmFkZS5tZXRhZGF0YS5xdWVyeS5mcm9tIT0nRVRIJyl7XG4gICAgICAgIC8vIGVyYzIwXG4gICAgICAgIGJhbGFuY2UgPSBhd2FpdCBhY2NvdW50LmdldEVSQzIwQmFsYW5jZSh0cmFkZSwgcHJvdmlkZXIsIHNpZ25lcik7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgLy8gZXRoXG4gICAgICAgIHRyeXtcbiAgICAgICAgICBiYWxhbmNlID0gYXdhaXQgYWNjb3VudC5nZXRFVEhCYWxhbmNlKHRyYWRlKTtcbiAgICAgICAgfWNhdGNoKGVycil7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfWNhdGNoKGVycil7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgfVxuICAgIGlmICghYmFsYW5jZSkge1xuICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdiYWxhbmNlJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIGhhbmRsZSB0b2tlbiBhbGxvd2FuY2VcbiAgICBpZiAodHJhZGUubWV0YWRhdGEuaW5wdXQpIHtcbiAgICAgIC8vIGdldCBjb250cmFjdHNcbiAgICAgIGNvbnN0IHRva2VuQ29udHJhY3QgPSB1dGlsaXR5LmdldFRva2VuQ29udHJhY3QodHJhZGUsIHNpZ25lcik7XG4gICAgICBjb25zdCBleGNoYW5nZUFkZHJlc3MgPSB0cmFkZS5tZXRhZGF0YS5pbnB1dC5zcGVuZGVyO1xuICAgICAgLy8gZ2V0IGNsaWVudCBhZGRyZXNzXG4gICAgICBjb25zdCBhZGRyZXNzID0gYXdhaXQgcHJvdmlkZXIuZ2V0U2lnbmVyKCkuZ2V0QWRkcmVzcygpO1xuICAgICAgLy8gZ2V0IGFsbG93YW5jZXNcbiAgICAgIGNvbnN0IGFsbG93YW5jZSA9IGF3YWl0IHRva2VuQ29udHJhY3QuYWxsb3dhbmNlKGFkZHJlc3MsIGV4Y2hhbmdlQWRkcmVzcyk7XG4gICAgICBjb25zdCB0b2tlbkFtb3VudCA9IHRyYWRlLm1ldGFkYXRhLmlucHV0LmFtb3VudDtcblxuICAgICAgaWYgKGFsbG93YW5jZS5sdCh0b2tlbkFtb3VudCkpIHtcbiAgICAgICAgLy8gYWxsb3dhbmNlIG5lZWRzIHRvIGJlIGdyYW50ZWRcbiAgICAgICAgd2luZG93LndlYjNTdGF0dXNIYW5kbGVyKCdhbGxvd2FuY2UnKTtcbiAgICAgICAgY29uc3QgdHJhZGluZ19hbGxvd2FuY2UgPSBhd2FpdCB0cmFkaW5nLnNldEFsbG93YW5jZSh0b2tlbkNvbnRyYWN0LCBleGNoYW5nZUFkZHJlc3MsIHByb3ZpZGVyKTtcbiAgICAgICAgLy8gY2hlY2sgaWYgdG9rZW4gYWxsb3dhbmNlIGlzIG5vdCBzZXRcbiAgICAgICAgaWYoIXRyYWRpbmdfYWxsb3dhbmNlKSByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IHZhbGlkYXRlO1xuIl19