"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_web=_interopRequireDefault(require("./web3")),_utility=_interopRequireDefault(require("./utility")),validation={validate:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d,e){var f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e("init"),b){a.next=3;break}return a.abrupt("return",!1);case 3:return a.next=5,_checkInternalProvider(c);case 5:if(f=a.sent,f){a.next=8;break}return a.abrupt("return",!1);case 8:return a.next=10,_checkBalance(b,c,d,e);case 10:if(g=a.sent,g){a.next=13;break}return a.abrupt("return",!1);case 13:return a.next=15,_checkAllowance(b,c,d,e);case 15:if(h=a.sent,h){a.next=18;break}return a.abrupt("return",!1);case 18:return a.abrupt("return",!0);case 19:case"end":return a.stop();}},a)}));return function validate(){return a.apply(this,arguments)}}()};function _checkInternalProvider(){return _checkInternalProvider2.apply(this,arguments)}function _checkInternalProvider2(){return _checkInternalProvider2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c=b._web3Provider,c){a.next=4;break}return console.log("internal provider not found"),a.abrupt("return",!0);case 4:if(c.selectedAddress){a.next=14;break}return a.prev=5,a.next=8,c.enable();case 8:a.next=14;break;case 10:return a.prev=10,a.t0=a["catch"](5),handler("connect_rejected"),a.abrupt("return",!1);case 14:if(c.selectedAddress){a.next=17;break}return handler("unlock_wallet"),a.abrupt("return",!1);case 17:if("1"==c.networkVersion){a.next=20;break}return handler("network"),a.abrupt("return",!1);case 20:return a.abrupt("return",!0);case 21:case"end":return a.stop();}},a,null,[[5,10]])})),_checkInternalProvider2.apply(this,arguments)}function _checkBalance(){return _checkBalance2.apply(this,arguments)}function _checkBalance2(){return _checkBalance2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d,e){var f,g,h,i;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,_utility["default"].getEtherToWrap(b,c,d);case 2:if(f=a.sent,-1!=f){a.next=6;break}return e("balance"),a.abrupt("return",!1);case 6:return g=_utility["default"].getWethContract(d),a.next=9,_web["default"].wrap(g,f,c,e);case 9:if(h=a.sent,h){a.next=12;break}return a.abrupt("return",!1);case 12:if("ETH"!=b.metadata.query.from){a.next=18;break}return a.next=15,_web["default"].getETHBalance(b,d);case 15:a.t0=a.sent,a.next=21;break;case 18:return a.next=20,_web["default"].getERC20Balance(b,d);case 20:a.t0=a.sent;case 21:if(i=a.t0,i){a.next=25;break}return e("balance"),a.abrupt("return",!1);case 25:return a.abrupt("return",!0);case 26:case"end":return a.stop();}},a)})),_checkBalance2.apply(this,arguments)}function _checkAllowance(){return _checkAllowance2.apply(this,arguments)}function _checkAllowance2(){return _checkAllowance2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d,e){var f,g,h,i,j,k;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b.metadata.input){a.next=2;break}return a.abrupt("return",!0);case 2:return f=_utility["default"].getTokenContract(b,d),g=b.metadata.input.spender,a.next=6,d.getAddress();case 6:return h=a.sent,a.next=9,f.allowance(h,g);case 9:if(i=a.sent,j=b.metadata.input.amount,!i.lt(j)){a.next=18;break}return e("allowance"),a.next=15,_web["default"].setAllowance(f,g,c,e);case 15:if(k=a.sent,k){a.next=18;break}return a.abrupt("return",!1);case 18:return a.abrupt("return",!0);case 19:case"end":return a.stop();}},a)})),_checkAllowance2.apply(this,arguments)}var _default=validation;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy92YWxpZGF0aW9uLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRpb24iLCJ2YWxpZGF0ZSIsInRyYWRlIiwicHJvdmlkZXIiLCJzaWduZXIiLCJoYW5kbGVyIiwiX2NoZWNrSW50ZXJuYWxQcm92aWRlciIsImludGVybmFsUHJvdmlkZXIiLCJfY2hlY2tCYWxhbmNlIiwiYmFsYW5jZSIsIl9jaGVja0FsbG93YW5jZSIsImFsbG93YW5jZSIsIl93ZWIzUHJvdmlkZXIiLCJjb25zb2xlIiwibG9nIiwic2VsZWN0ZWRBZGRyZXNzIiwiZW5hYmxlIiwibmV0d29ya1ZlcnNpb24iLCJ1dGlsaXR5IiwiZ2V0RXRoZXJUb1dyYXAiLCJldGhlclRvV3JhcCIsIndldGhDb250cmFjdCIsImdldFdldGhDb250cmFjdCIsIndlYjMiLCJ3cmFwIiwid3JhcHBpbmciLCJtZXRhZGF0YSIsInF1ZXJ5IiwiZnJvbSIsImdldEVUSEJhbGFuY2UiLCJnZXRFUkMyMEJhbGFuY2UiLCJpbnB1dCIsInRva2VuQ29udHJhY3QiLCJnZXRUb2tlbkNvbnRyYWN0IiwiZXhjaGFuZ2VBZGRyZXNzIiwic3BlbmRlciIsImdldEFkZHJlc3MiLCJhZGRyZXNzIiwidG9rZW5BbW91bnQiLCJhbW91bnQiLCJsdCIsInNldEFsbG93YW5jZSIsInRyYWRpbmdfYWxsb3dhbmNlIl0sIm1hcHBpbmdzIjoibWNBR01BLFVBQVUsQ0FBRyxDQUNYQyxRQURXLHlHQUNGQyxDQURFLENBQ0tDLENBREwsQ0FDZUMsQ0FEZixDQUN1QkMsQ0FEdkIsbUdBRWZBLENBQU8sQ0FBQyxNQUFELENBRlEsQ0FHVkgsQ0FIVSxxRUFNZ0JJLHNCQUFzQixDQUFDSCxDQUFELENBTnRDLFdBTVRJLENBTlMsUUFPVkEsQ0FQVSxzRUFVT0MsYUFBYSxDQUFDTixDQUFELENBQVFDLENBQVIsQ0FBa0JDLENBQWxCLENBQTBCQyxDQUExQixDQVZwQixZQVVUSSxDQVZTLFFBV1ZBLENBWFUsd0VBY1NDLGVBQWUsQ0FBQ1IsQ0FBRCxDQUFRQyxDQUFSLENBQWtCQyxDQUFsQixDQUEwQkMsQ0FBMUIsQ0FkeEIsWUFjVE0sQ0FkUyxRQWVWQSxDQWZVLDZMLFNBc0JKTCxDQUFBQSxzQixzTUFBZixXQUFzQ0gsQ0FBdEMsK0ZBQ1FJLENBRFIsQ0FDMkJKLENBQVEsQ0FBQ1MsYUFEcEMsQ0FFT0wsQ0FGUCx1QkFJSU0sQ0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksNkJBQVosQ0FKSixpQ0FRT1AsQ0FBZ0IsQ0FBQ1EsZUFSeEIsMkNBVVlSLENBQWdCLENBQUNTLE1BQWpCLEVBVlosb0VBYU1YLE9BQU8sQ0FBQyxrQkFBRCxDQWJiLGtDQW1CT0UsQ0FBZ0IsQ0FBQ1EsZUFuQnhCLHdCQW9CSVYsQ0FBQUEsT0FBTyxDQUFDLGVBQUQsQ0FwQlgsa0NBd0J5QyxHQUFuQyxFQUFBRSxDQUFnQixDQUFDVSxjQXhCdkIsd0JBeUJJWixDQUFBQSxPQUFPLENBQUMsU0FBRCxDQXpCWCxrSCx5REErQmVHLENBQUFBLGEsMktBQWYsV0FBNkJOLENBQTdCLENBQW9DQyxDQUFwQyxDQUE4Q0MsQ0FBOUMsQ0FBc0RDLENBQXRELGtIQUU0QmEsb0JBQVFDLGNBQVIsQ0FBdUJqQixDQUF2QixDQUE4QkMsQ0FBOUIsQ0FBd0NDLENBQXhDLENBRjVCLFdBRVFnQixDQUZSLFFBR3FCLENBQUMsQ0FBaEIsRUFBQUEsQ0FITix1QkFJSWYsQ0FBQUEsQ0FBTyxDQUFDLFNBQUQsQ0FKWCxvQ0FRUWdCLENBQUFBLENBUlIsQ0FRdUJILG9CQUFRSSxlQUFSLENBQXdCbEIsQ0FBeEIsQ0FSdkIsVUFTeUJtQixnQkFBS0MsSUFBTCxDQUFVSCxDQUFWLENBQXdCRCxDQUF4QixDQUFxQ2pCLENBQXJDLENBQStDRSxDQUEvQyxDQVR6QixXQVNRb0IsQ0FUUixRQVVPQSxDQVZQLDBEQWE4QyxLQUE1QixFQUFBdkIsQ0FBSyxDQUFDd0IsUUFBTixDQUFlQyxLQUFmLENBQXFCQyxJQWJ2QyxtQ0FjWUwsZ0JBQUtNLGFBQUwsQ0FBbUIzQixDQUFuQixDQUEwQkUsQ0FBMUIsQ0FkWiw4REFlWW1CLGdCQUFLTyxlQUFMLENBQXFCNUIsQ0FBckIsQ0FBNEJFLENBQTVCLENBZlosZ0NBYVFLLENBYlIsTUFnQk9BLENBaEJQLHdCQWlCSUosQ0FBQUEsQ0FBTyxDQUFDLFNBQUQsQ0FqQlgsb0csZ0RBdUJlSyxDQUFBQSxlLGlMQUFmLFdBQStCUixDQUEvQixDQUFzQ0MsQ0FBdEMsQ0FBZ0RDLENBQWhELENBQXdEQyxDQUF4RCx5R0FDT0gsQ0FBSyxDQUFDd0IsUUFBTixDQUFlSyxLQUR0QiwyREFLUUMsQ0FBQUEsQ0FMUixDQUt3QmQsb0JBQVFlLGdCQUFSLENBQXlCL0IsQ0FBekIsQ0FBZ0NFLENBQWhDLENBTHhCLENBTVE4QixDQU5SLENBTTBCaEMsQ0FBSyxDQUFDd0IsUUFBTixDQUFlSyxLQUFmLENBQXFCSSxPQU4vQyxVQVF3Qi9CLENBQU0sQ0FBQ2dDLFVBQVAsRUFSeEIsY0FRUUMsQ0FBQUEsQ0FSUixpQkFVMEJMLENBQWEsQ0FBQ3JCLFNBQWQsQ0FBd0IwQixDQUF4QixDQUFpQ0gsQ0FBakMsQ0FWMUIsV0FVUXZCLENBVlIsUUFXUTJCLENBWFIsQ0FXc0JwQyxDQUFLLENBQUN3QixRQUFOLENBQWVLLEtBQWYsQ0FBcUJRLE1BWDNDLEVBYU01QixDQUFTLENBQUM2QixFQUFWLENBQWFGLENBQWIsQ0FiTix3QkFlSWpDLENBQUFBLENBQU8sQ0FBQyxXQUFELENBZlgsV0FnQm9Da0IsZ0JBQUtrQixZQUFMLENBQWtCVCxDQUFsQixDQUFpQ0UsQ0FBakMsQ0FBa0QvQixDQUFsRCxDQUE0REUsQ0FBNUQsQ0FoQnBDLFlBZ0JVcUMsQ0FoQlYsUUFrQlNBLENBbEJULDRILHVEQXlCZTFDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgd2ViMyBmcm9tICcuL3dlYjMnO1xuaW1wb3J0IHV0aWxpdHkgZnJvbSAnLi91dGlsaXR5JztcblxuY29uc3QgdmFsaWRhdGlvbiA9IHtcbiAgYXN5bmMgdmFsaWRhdGUodHJhZGUsIHByb3ZpZGVyLCBzaWduZXIsIGhhbmRsZXIpIHtcbiAgICBoYW5kbGVyKCdpbml0Jyk7XG4gICAgaWYgKCF0cmFkZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBpbnRlcm5hbFByb3ZpZGVyID0gYXdhaXQgX2NoZWNrSW50ZXJuYWxQcm92aWRlcihwcm92aWRlcik7XG4gICAgaWYgKCFpbnRlcm5hbFByb3ZpZGVyKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGJhbGFuY2UgPSBhd2FpdCBfY2hlY2tCYWxhbmNlKHRyYWRlLCBwcm92aWRlciwgc2lnbmVyLCBoYW5kbGVyKTtcbiAgICBpZiAoIWJhbGFuY2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgYWxsb3dhbmNlID0gYXdhaXQgX2NoZWNrQWxsb3dhbmNlKHRyYWRlLCBwcm92aWRlciwgc2lnbmVyLCBoYW5kbGVyKTtcbiAgICBpZiAoIWFsbG93YW5jZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfY2hlY2tJbnRlcm5hbFByb3ZpZGVyKHByb3ZpZGVyKSB7XG4gIGNvbnN0IGludGVybmFsUHJvdmlkZXIgPSBwcm92aWRlci5fd2ViM1Byb3ZpZGVyO1xuICBpZiAoIWludGVybmFsUHJvdmlkZXIpIHtcbiAgICAvLyBJbnRlcm5hbCBwcm92aWRlciBub3QgZm91bmRcbiAgICBjb25zb2xlLmxvZygnaW50ZXJuYWwgcHJvdmlkZXIgbm90IGZvdW5kJyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpZiAoIWludGVybmFsUHJvdmlkZXIuc2VsZWN0ZWRBZGRyZXNzKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGludGVybmFsUHJvdmlkZXIuZW5hYmxlKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gdXNlciByZWplY3RlZFxuICAgICAgaGFuZGxlcignY29ubmVjdF9yZWplY3RlZCcpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIEF1dG8gdW5sb2NrIGRpZG50IHdvcmssIHdhbGxldCBpcyBzdGlsbCBsb2NrZWRcbiAgaWYgKCFpbnRlcm5hbFByb3ZpZGVyLnNlbGVjdGVkQWRkcmVzcykge1xuICAgIGhhbmRsZXIoJ3VubG9ja193YWxsZXQnKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoaW50ZXJuYWxQcm92aWRlci5uZXR3b3JrVmVyc2lvbiAhPSBcIjFcIikge1xuICAgIGhhbmRsZXIoJ25ldHdvcmsnKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9jaGVja0JhbGFuY2UodHJhZGUsIHByb3ZpZGVyLCBzaWduZXIsIGhhbmRsZXIpIHtcbiAgLy8gY2hlY2sgaWYgZXRoZXIgYmFsYW5jZSBpcyBpbnN1ZmZpY2llbnRcbiAgY29uc3QgZXRoZXJUb1dyYXAgPSBhd2FpdCB1dGlsaXR5LmdldEV0aGVyVG9XcmFwKHRyYWRlLCBwcm92aWRlciwgc2lnbmVyKTtcbiAgaWYgKGV0aGVyVG9XcmFwID09IC0xKSB7XG4gICAgaGFuZGxlcignYmFsYW5jZScpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICAvLyB3cmFwIGV0aGVyIGlmIG5lY2Vzc2FyeVxuICBjb25zdCB3ZXRoQ29udHJhY3QgPSB1dGlsaXR5LmdldFdldGhDb250cmFjdChzaWduZXIpO1xuICBjb25zdCB3cmFwcGluZyA9IGF3YWl0IHdlYjMud3JhcCh3ZXRoQ29udHJhY3QsIGV0aGVyVG9XcmFwLCBwcm92aWRlciwgaGFuZGxlcik7XG4gIGlmICghd3JhcHBpbmcpIHJldHVybiBmYWxzZTtcblxuICAvLyBDaGVjayBpZiBiYWxhbmNlIGlzIGluc3VmZmljaWVudFxuICBjb25zdCBiYWxhbmNlID0gdHJhZGUubWV0YWRhdGEucXVlcnkuZnJvbSA9PSdFVEgnXG4gICAgPyBhd2FpdCB3ZWIzLmdldEVUSEJhbGFuY2UodHJhZGUsIHNpZ25lcilcbiAgICA6IGF3YWl0IHdlYjMuZ2V0RVJDMjBCYWxhbmNlKHRyYWRlLCBzaWduZXIpO1xuICBpZiAoIWJhbGFuY2UpIHtcbiAgICBoYW5kbGVyKCdiYWxhbmNlJyk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfY2hlY2tBbGxvd2FuY2UodHJhZGUsIHByb3ZpZGVyLCBzaWduZXIsIGhhbmRsZXIpIHtcbiAgaWYgKCF0cmFkZS5tZXRhZGF0YS5pbnB1dCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIC8vIGdldCBjb250cmFjdHNcbiAgY29uc3QgdG9rZW5Db250cmFjdCA9IHV0aWxpdHkuZ2V0VG9rZW5Db250cmFjdCh0cmFkZSwgc2lnbmVyKTtcbiAgY29uc3QgZXhjaGFuZ2VBZGRyZXNzID0gdHJhZGUubWV0YWRhdGEuaW5wdXQuc3BlbmRlcjtcbiAgLy8gZ2V0IGNsaWVudCBhZGRyZXNzXG4gIGNvbnN0IGFkZHJlc3MgPSBhd2FpdCBzaWduZXIuZ2V0QWRkcmVzcygpO1xuICAvLyBnZXQgYWxsb3dhbmNlc1xuICBjb25zdCBhbGxvd2FuY2UgPSBhd2FpdCB0b2tlbkNvbnRyYWN0LmFsbG93YW5jZShhZGRyZXNzLCBleGNoYW5nZUFkZHJlc3MpO1xuICBjb25zdCB0b2tlbkFtb3VudCA9IHRyYWRlLm1ldGFkYXRhLmlucHV0LmFtb3VudDtcblxuICBpZiAoYWxsb3dhbmNlLmx0KHRva2VuQW1vdW50KSkge1xuICAgIC8vIGFsbG93YW5jZSBuZWVkcyB0byBiZSBncmFudGVkXG4gICAgaGFuZGxlcignYWxsb3dhbmNlJyk7XG4gICAgY29uc3QgdHJhZGluZ19hbGxvd2FuY2UgPSBhd2FpdCB3ZWIzLnNldEFsbG93YW5jZSh0b2tlbkNvbnRyYWN0LCBleGNoYW5nZUFkZHJlc3MsIHByb3ZpZGVyLCBoYW5kbGVyKTtcbiAgICAvLyBjaGVjayBpZiB0b2tlbiBhbGxvd2FuY2UgaXMgbm90IHNldFxuICAgIGlmICghdHJhZGluZ19hbGxvd2FuY2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHZhbGlkYXRpb247XG4iXX0=